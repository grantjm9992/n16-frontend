"use strict";(self.webpackChunknobleui_angular=self.webpackChunknobleui_angular||[]).push([[443],{5443:(F,c,s)=>{s.r(c),s.d(c,{CalendarModule:()=>J});var d=s(6895),h=s(7552),v=s(3401),g=s(7778),C=s(821),f=s(28),S=s(7789),e=s(4650),A=s(6347),T=s(3688),Z=s(5954),y=s(5902),b=s(8386),u=s(9476),o=s(433),p=s(9177),m=s(9061);const M=["calendar"];function x(a,r){if(1&a){const t=e.EpF();e.TgZ(0,"div",21)(1,"input",22),e.NdJ("change",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.toggleUpdate())}),e.qZA(),e.TgZ(2,"label",19),e._uU(3,"Update this and future classes"),e.qZA()()}}function _(a,r){if(1&a){const t=e.EpF();e.TgZ(0,"div",4)(1,"div",5)(2,"div",6)(3,"div",7)(4,"h6",8),e._uU(5,"Filter classes"),e.qZA(),e.TgZ(6,"div",4)(7,"div",9)(8,"label",10),e._uU(9,"Company"),e.qZA(),e.TgZ(10,"ng-select",11),e.NdJ("change",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.filterResources())})("ngModelChange",function(n){e.CHM(t);const l=e.oxw();return e.KtG(l.selectedSimpleItem=n)}),e.qZA()(),e.TgZ(11,"div",9)(12,"label",10),e._uU(13,"Date"),e.qZA(),e.TgZ(14,"div",12)(15,"input",13,14),e.NdJ("dateSelect",function(n){e.CHM(t);const l=e.oxw();return e.KtG(l.updateDate(n))}),e.qZA(),e.TgZ(17,"button",15),e.NdJ("click",function(){e.CHM(t);const n=e.MAs(16);return e.KtG(n.toggle())}),e._UZ(18,"i",16),e.qZA()()()()()()(),e.TgZ(19,"div",5)(20,"div",6)(21,"div",7)(22,"div",17)(23,"input",18),e.NdJ("change",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.toggleScroll())})("ngModelChange",function(n){e.CHM(t);const l=e.oxw();return e.KtG(l.allowScroll=n)}),e.qZA(),e.TgZ(24,"label",19),e._uU(25,"Allow scroll"),e.qZA()(),e.YNc(26,x,4,0,"div",20),e.qZA()()()()}if(2&a){const t=e.oxw();e.xp6(10),e.Q6J("items",t.simpleItems)("multiple",!0)("searchable",!0)("ngModel",t.selectedSimpleItem),e.xp6(13),e.Q6J("ngModel",t.allowScroll),e.xp6(3),e.Q6J("ngIf",t.userService.canEditTimetable())}}let E=(()=>{class a{constructor(t,i,n,l,U){this.classroomApiService=t,this.eventApiService=i,this.companyApiService=n,this.teacherApiService=l,this.userService=U,this.groupedEvents=[],this.updateThisAndFutureClasses=!1,this.resources=[],this.simpleItems=[],this.allowScroll=!1,this.calendarOptions={editable:!1,eventStartEditable:!1,eventDurationEditable:!1,resourceOrder:"title",eventDrop:this.updateEvent.bind(this),resourceEditable:!0,startParam:"start_date",endParam:"end_date",titleParam:"description",slotMinTime:"07:00:00",slotMaxTime:"23:00:00",snapDuration:"00:05:00",titleFormat:{month:"long",year:"numeric",day:"numeric",weekday:"long"},eventMinHeight:5,height:"830px",contentHeight:"830px",allDaySlot:!1,datesSet:this.getEventsForDate.bind(this),initialView:"resourceTimeGrid",events:[],resources:this.resources,plugins:[h.Z,v.Z,g.Z,C.ZP,S.Z,f.Z],schedulerLicenseKey:"CC-Attribution-NonCommercial-NoDerivatives"},this.companies=[]}toggleUpdate(){this.updateThisAndFutureClasses=!this.updateThisAndFutureClasses}getEventsForDate(t){let i=t.startStr.substring(0,10);this.eventApiService.getEvents(i,"true").subscribe(n=>{this.calendarOptions.events=n.data})}toggleScroll(){this.calendarOptions.dayMinWidth=!!this.allowScroll&&80}updateEvent(t){this.updateThisAndFutureClasses?this.eventApiService.updateEventTeacherForGroup(t.event.id,t.newResource.id).subscribe(i=>{console.log("updated")}):this.eventApiService.updateEventTeacher(t.event.id,t.newResource.id).subscribe(i=>{console.log("updated")})}filterResources(){this.calendarOptions.resources=this.resources.filter(t=>"not_set"===t.company_id||(this.selectedSimpleItem.includes("not_set")?(this.selectedSimpleItem=["not_set"],!0):this.selectedSimpleItem.includes(t.company_id)))}ngOnInit(){this.activeUser=this.userService.getUser(),this.userService.canEditTimetable()&&(this.calendarOptions.editable=!0),this.companyApiService.getCompanies().subscribe(t=>{this.simpleItems=[{id:"not_set",name:"All companies"}].concat(t.data),this.teacherApiService.getTeachers().subscribe(n=>{this.resources=n.data,this.selectedSimpleItem=["not_set"],this.filterResources()}),this.eventApiService.getEvents("","true").subscribe(n=>{this.calendarOptions.events=n.data})})}updateDate(t){this.calendarComponent.getApi().gotoDate(this.getDateString(t))}getDateString(t){return`${t.year}-${this.pad(t.month)}-${this.pad(t.day)}`}pad(t,i=2){let n=t+"";for(;n.length<i;)n="0"+n;return n}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(A.s),e.Y36(T.L),e.Y36(Z.s),e.Y36(y.O),e.Y36(b.K))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-calendar"]],viewQuery:function(t,i){if(1&t&&e.Gf(M,5),2&t){let n;e.iGM(n=e.CRH())&&(i.calendarComponent=n.first)}},decls:4,vars:2,consts:[["class","row",4,"ngIf"],[2,"width","unset","overflow-x","scroll"],[3,"options"],["calendar",""],[1,"row"],[1,"col-md-6","grid-margin","stretch-card"],[1,"card"],[1,"card-body"],[1,"card-title"],[1,"col-md-6"],[1,"form-label"],["bindLabel","name","bindValue","id",3,"items","multiple","searchable","ngModel","change","ngModelChange"],[1,"input-group"],["placeholder","yyyy-mm-dd","ngbDatepicker","",1,"form-control",3,"dateSelect"],["date","ngbDatepicker"],["type","button",1,"input-group-text",3,"click"],[1,"feather","icon-calendar","icon-md","text-muted"],[1,"form-check","form-switch","mb-3"],["type","checkbox",1,"form-check-input",3,"ngModel","change","ngModelChange"],[1,"form-check-label"],["class","form-check form-switch mb-2",4,"ngIf"],[1,"form-check","form-switch","mb-2"],["type","checkbox",1,"form-check-input",3,"change"]],template:function(t,i){1&t&&(e.YNc(0,_,27,6,"div",0),e.TgZ(1,"div",1),e._UZ(2,"full-calendar",2,3),e.qZA()),2&t&&(e.Q6J("ngIf","super_admin"==i.activeUser.user_role||"admin"),e.xp6(2),e.Q6J("options",i.calendarOptions))},dependencies:[d.O5,u.w,o.Wl,o.JJ,o.On,p.w9,m.J4]}),a})();var D=s(3599);const I=[{path:"",component:E}];let J=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[d.ez,u.z,D.Bz.forChild(I),o.u5,o.UX,p.A0,m.M]}),a})()}}]);